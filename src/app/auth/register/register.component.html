<div class="register-container">
  <div class="register-background"></div>

  <div class="register-card shadow-lg border-0">
    <div class="card-body p-4">
      <div class="text-center mb-2">
        <div class="register-logo">
          <i class="bi bi-person-plus-fill"></i>
        </div>
        <p class="register-subtitle">Crea tu cuenta</p>
      </div>

      <!-- Formulario -->
      <form [formGroup]="registerForm" (ngSubmit)="register()" class="register-form">

        <!-- Campo Nombre -->
        <div class="form-floating mb-3">
          <input
            type="text"
            id="name"
            class="form-control modern-input"
            formControlName="name"
            placeholder="Nombre completo"
            [class.is-invalid]="name?.invalid && name?.touched"
            required>
          <label for="name">
            <i class="bi bi-person me-2"></i>Nombre completo
          </label>
          <div class="invalid-feedback" *ngIf="name?.touched && name?.errors">
            <span *ngIf="name?.errors?.['required']">El nombre es requerido</span>
            <span *ngIf="name?.errors?.['minlength']">Mínimo 2 caracteres</span>
          </div>
        </div>

        <!-- Campo Email -->
        <div class="form-floating mb-3">
          <input
            type="email"
            id="email"
            class="form-control modern-input"
            formControlName="email"
            placeholder="Email"
            [class.is-invalid]="email?.invalid && email?.touched"
            required>
          <label for="email">
            <i class="bi bi-envelope me-2"></i>Email
          </label>
          <div class="invalid-feedback" *ngIf="email?.touched && email?.errors">
            <span *ngIf="email?.errors?.['required']">El email es requerido</span>
            <span *ngIf="email?.errors?.['email']">Email inválido</span>
          </div>
        </div>

        <!-- Campo Documento -->
        <div class="form-floating mb-3">
          <input
            type="text"
            id="document"
            class="form-control modern-input"
            formControlName="document"
            placeholder="Documento"
            [class.is-invalid]="document?.invalid && document?.touched"
            required>
          <label for="document">
            <i class="bi bi-card-text me-2"></i>Documento
          </label>
          <div class="invalid-feedback" *ngIf="document?.touched && document?.errors">
            <span *ngIf="document?.errors?.['required']">El documento es requerido</span>
            <span *ngIf="document?.errors?.['minlength']">Mínimo 8 caracteres</span>
          </div>
        </div>

        <!-- Campo Usuario -->
        <div class="form-floating mb-3">
          <input
            type="text"
            id="username"
            class="form-control modern-input"
            formControlName="username"
            placeholder="Usuario"
            [class.is-invalid]="username?.invalid && username?.touched"
            required>
          <label for="username">
            <i class="bi bi-at me-2"></i>Usuario
          </label>
          <div class="invalid-feedback" *ngIf="username?.touched && username?.errors">
            <span *ngIf="username?.errors?.['required']">El usuario es requerido</span>
            <span *ngIf="username?.errors?.['minlength']">Mínimo 3 caracteres</span>
          </div>
        </div>

        <!-- Campo Contraseña -->
        <div class="form-floating mb-3">
          <input
            [type]="showPassword() ? 'text' : 'password'"
            id="password"
            class="form-control modern-input"
            formControlName="password"
            placeholder="Contraseña"
            [class.is-invalid]="password?.invalid && password?.touched"
            required>
          <label for="password">
            <i class="bi bi-lock me-2"></i>Contraseña
          </label>

          <button
            type="button"
            class="btn password-toggle"
            (click)="togglePassword()">
            <i class="bi" [ngClass]="showPassword() ? 'bi-eye-slash' : 'bi-eye'"></i>
          </button>

          <div class="invalid-feedback" *ngIf="password?.touched && password?.errors">
            <span *ngIf="password?.errors?.['required']">La contraseña es requerida</span>
            <span *ngIf="password?.errors?.['minlength']">Mínimo 6 caracteres</span>
          </div>
        </div>

        <!-- Campo Confirmar Contraseña -->
        <div class="form-floating mb-4">
          <input
            [type]="showConfirmPassword() ? 'text' : 'password'"
            id="confirmPassword"
            class="form-control modern-input"
            formControlName="confirmPassword"
            placeholder="Confirmar contraseña"
            [class.is-invalid]="(confirmPassword?.invalid && confirmPassword?.touched) || passwordsMismatch"
            required>
          <label for="confirmPassword">
            <i class="bi bi-lock-fill me-2"></i>Confirmar contraseña
          </label>

          <button
            type="button"
            class="btn password-toggle"
            (click)="toggleConfirmPassword()">
            <i class="bi" [ngClass]="showConfirmPassword() ? 'bi-eye-slash' : 'bi-eye'"></i>
          </button>

          <div class="invalid-feedback" *ngIf="confirmPassword?.touched">
            <span *ngIf="confirmPassword?.errors?.['required']">Confirma tu contraseña</span>
            <span *ngIf="passwordsMismatch">Las contraseñas no coinciden</span>
          </div>
        </div>

        <!-- Error Message -->
        @if (error()) {
          <div class="alert alert-danger alert-modern" role="alert">
            <i class="bi bi-exclamation-triangle-fill me-2"></i>
            {{ error() }}
          </div>
        }

        <!-- Botón de Registro -->
        <div class="d-grid mb-3">
          <button
            type="submit"
            class="btn btn-success btn-modern"
            [disabled]="registerForm.invalid || loading()">

            @if (loading()) {
              <div class="spinner-border spinner-border-sm me-2" role="status">
                <span class="visually-hidden">Cargando...</span>
              </div>
              Creando cuenta...
            } @else {
              <i class="bi bi-person-plus me-2"></i>
              Crear cuenta
            }
          </button>
        </div>

      </form>

      <!-- Footer del Card -->
      <div class="text-center">
        <p class="text-muted mb-2">¿Ya tienes cuenta?</p>
        <a href="/auth" class="btn btn-outline-primary btn-sm">
          <i class="bi bi-box-arrow-in-right me-2"></i>Iniciar sesión
        </a>
      </div>

    </div>
  </div>
</div>
